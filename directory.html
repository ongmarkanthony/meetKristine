<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Directory</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="./report_style.css">
</head>

<style>
.modal-image {
  max-width: 100%;
  height: auto;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
</style>

<body>
  <aside>
    <div id="main">
      <button class="openbtn" onclick="openNav()">&#9776;Directory</button>
  </div>     
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="#">Employee List</a>      
      <a href="#">Contact</a>
  </div>
  </aside>
<main class="container-fluid">
  <div class="container mt-mb-4" style="height: 79vh;">
    <h1 class="mb-4">Employee Directory</h1>
    <div class="form-group">
      <input type="text" class="form-control" id="searchInput">
    </div>
    <div class="row" id="employeeList"></div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="employeeModal" tabindex="-1" role="dialog" aria-labelledby="employeeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="employeeModalLabel">Employee Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Employee details will be dynamically populated here -->
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    async function fetchEmployees() {
      try {
        const response = await fetch('https://randomuser.me/api/?results=20');
        const data = await response.json();
        return data.results;
      } catch (error) {
        console.error('Error fetching employees:', error);
        return [];
      }
    }

    // Function to generate employee cards
    function generateEmployeeCard(employee) {
      return `
        <div class="col-md-4 mb-4">
          <div class="card">
            <img src="${employee.picture.large}" class="card-img-top" alt="${employee.name.first} ${employee.name.last}" data-toggle="modal" data-target="#employeeModal" data-employee='${JSON.stringify(
        employee
      )}'>
            <div class="card-body">
              <h5 class="card-title">${employee.name.first} ${employee.name.last}</h5>
              <p class="card-text">${employee.email}</p>
            </div>
          </div>
        </div>
      `;
    }

    // Function to render employee cards
    function renderEmployeeCards(employeeList) {
      const employeeListContainer = document.getElementById('employeeList');
      employeeListContainer.innerHTML = employeeList.map(generateEmployeeCard).join('');
    }

    // Function to filter employees based on search input
    function filterEmployees(searchTerm, employees) {
      return employees.filter(
        (employee) =>
          employee.name.first.toLowerCase().includes(searchTerm.toLowerCase()) ||
          employee.name.last.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }

    // Function to display employee details in the modal
    function displayEmployeeDetails(employee) {
      const modalBody = document.getElementById('modalBody');
      modalBody.innerHTML = `
        <p><strong>Name:</strong> ${employee.name.title} ${employee.name.first} ${employee.name.last}</p>
        <p><strong>Gender:</strong> ${employee.gender}</p>
        <p><strong>Location:</strong> ${employee.location.street.number} ${employee.location.street.name}, ${employee.location.city}, ${employee.location.state}, ${employee.location.country}, ${employee.location.postcode}</p>
        <p><strong>Email:</strong> ${employee.email}</p>
        <p><strong>Phone:</strong> ${employee.phone}</p>
        <p><strong>Cell:</strong> ${employee.cell}</p>
        <img src="${employee.picture.large}" alt="${employee.name.first} ${employee.name.last}" class="img-fluid">
      `;
    }

    // Event listener for the search input
    document.getElementById('searchInput').addEventListener('input', async (event) => {
      const searchTerm = event.target.value;
      const employees = await fetchEmployees();
      const filteredEmployees = filterEmployees(searchTerm, employees);
      renderEmployeeCards(filteredEmployees);
    });

    // Event listener for showing modal with employee details
    $(document).on('click', '.card-img-top', function () {
      const employee = JSON.parse(this.dataset.employee);
      displayEmployeeDetails(employee);
    });

    // Fetch employees and render the initial employee list
    (async () => {
      const employees = await fetchEmployees();
      renderEmployeeCards(employees);
    })();
  </script>
  <script src="./dbReport.js"></script>
</body>
</html>
